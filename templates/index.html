<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crop Water Requirement Predictor</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script>
    function calculateET() {
      const temp = parseFloat(document.querySelector('input[name="temperature"]').value) || 0;
      const humid = parseFloat(document.querySelector('input[name="humidity"]').value) || 0;
      const wind = parseFloat(document.querySelector('input[name="wind_speed"]').value) || 0;
      const solar = parseFloat(document.querySelector('input[name="solar_rad"]').value) || 0;

      if (solar > 0) {
        const ET = (0.0023 * (temp + 17.8) * Math.sqrt(solar) * (1 - humid / 100)) + (0.1 * wind);
        document.getElementById("etDisplay").innerText = "Estimated ET: " + ET.toFixed(2) + " mm/day";
      } else {
        document.getElementById("etDisplay").innerText = "";
      }
    }

    function validateForm(event) {
      const fields = [
        { name: "temperature", min: 15, max: 34.9 },
        { name: "humidity", min: 40, max: 89.9 },
        { name: "rainfall", min: 20, max: 149.9 },
        { name: "wind_speed", min: 2.1, max: 15 },
        { name: "solar_rad", min: 180.5, max: 320 },
        { name: "precipitation", min: 0.1, max: 30 }
      ];

      for (let field of fields) {
        const val = parseFloat(document.querySelector(`input[name="${field.name}"]`).value);
        if (isNaN(val) || val < field.min || val > field.max) {
          alert(`${field.name.replace("_", " ")} must be between ${field.min} and ${field.max}`);
          event.preventDefault();
          return false;
        }
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      const inputs = document.querySelectorAll('input');
      inputs.forEach(i => i.addEventListener('input', calculateET));
      document.querySelector("form").addEventListener("submit", validateForm);
    });
  </script>
</head>
<body>
  <h2>ðŸŒ¿ Crop Water Requirement Predictor</h2>
  <form method="POST" action="/result">
    <label>Crop:</label>
    <select name="crop">{% for c in crops %}<option>{{ c }}</option>{% endfor %}</select>

    <label>Temperature (Â°C):</label>
    <input type="number" step="0.1" name="temperature" placeholder="15 to 34.5" required>

    <label>Humidity (%):</label>
    <input type="number" step="0.1" name="humidity" placeholder="40 to 89.9" required>

    <label>Rainfall (mm):</label>
    <input type="number" step="0.1" name="rainfall" placeholder="20 to 149.9" required>

    <label>Wind Speed (km/h):</label>
    <input type="number" step="0.1" name="wind_speed" placeholder="2.1 to 15" required>

    <label>Solar Radiation (W/mÂ²):</label>
    <input type="number" step="0.1" name="solar_rad" placeholder="180.5 to 320" required>

    <label>Precipitation (mm):</label>
    <input type="number" step="0.1" name="precipitation" placeholder="0.1 to 30" required>

    <div id="etDisplay" style="margin-top: 15px; font-weight: bold; color: #2e8b57;"></div>

    <input type="submit" value="Predict Water Requirement">
  </form>
</body>
</html>
